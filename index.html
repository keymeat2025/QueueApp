<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QueueApp - Smart Queue Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        /* CSS Variables & Reset */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #f97316; --primary-dark: #ea580c; --secondary: #ec4899;
            --success: #22c55e; --warning: #eab308; --danger: #dc2626;
            --gray-50: #f9fafb; --gray-100: #f3f4f6; --gray-200: #e5e7eb;
            --gray-600: #4b5563; --gray-700: #374151; --gray-900: #111827; --white: #ffffff;
        }
        
        /* Base Styles */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: var(--gray-900); background: var(--gray-50); font-size: 16px; }
        h1 { font-size: clamp(1.5rem, 4vw, 3.5rem); font-weight: 700; }
        h2 { font-size: clamp(1.25rem, 3vw, 2.5rem); font-weight: 700; }
        h3 { font-size: clamp(1.1rem, 2.5vw, 2rem); font-weight: 600; }
        
        /* Layout */
        .container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 clamp(1rem, 3vw, 2rem); }
        nav { background: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: clamp(0.75rem, 2vw, 1.5rem); position: sticky; top: 0; z-index: 100; }
        nav .nav-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        nav h1 { color: var(--primary); cursor: pointer; font-size: clamp(1.25rem, 3vw, 2rem); }
        nav .nav-buttons { display: flex; gap: clamp(0.5rem, 1.5vw, 1rem); flex-wrap: wrap; }
        
        /* Buttons */
        button, .btn { padding: clamp(0.5rem, 1.5vw, 1rem) clamp(1rem, 3vw, 2rem); border: none; border-radius: clamp(0.5rem, 1vw, 1rem); font-size: clamp(0.875rem, 1.5vw, 1.125rem); font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-block; text-align: center; }
        button:hover, .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: var(--white); }
        .btn-secondary { background: var(--gray-600); color: var(--white); }
        .btn-success { background: var(--success); color: var(--white); }
        .btn-danger { background: var(--danger); color: var(--white); }
        .btn-warning { background: var(--warning); color: var(--white); }
        
        /* Cards & Grid */
        .card { background: var(--white); border-radius: clamp(1rem, 2vw, 2rem); padding: clamp(1.5rem, 3vw, 3rem); box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: clamp(1rem, 2vw, 2rem); }
        .grid { display: grid; gap: clamp(1rem, 2vw, 2rem); margin-bottom: clamp(1rem, 2vw, 2rem); }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(min(150px, 100%), 1fr)); }
        
        /* Form Elements */
        input, select, textarea { width: 100%; padding: clamp(0.75rem, 2vw, 1.25rem); border: 2px solid var(--gray-200); border-radius: clamp(0.5rem, 1vw, 1rem); font-size: clamp(0.875rem, 1.5vw, 1.125rem); margin-bottom: clamp(0.75rem, 1.5vw, 1.5rem); transition: border 0.3s ease; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); }
        
        /* Badges & Backgrounds */
        .badge { display: inline-block; padding: clamp(0.25rem, 0.5vw, 0.5rem) clamp(0.5rem, 1vw, 1rem); border-radius: 999px; font-size: clamp(0.75rem, 1vw, 0.875rem); font-weight: 700; }
        .badge-primary { background: var(--primary); color: var(--white); }
        .badge-warning { background: var(--warning); color: var(--white); }
        .badge-secondary { background: var(--gray-600); color: var(--white); }
        .bg-gradient { background: linear-gradient(135deg, #fff7ed 0%, #fce7f3 100%); }
        .bg-gradient-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: var(--white); }
        
        /* Display Screen for TVs */
        .display-screen { background: linear-gradient(135deg, #1f2937 0%, #111827 100%); color: var(--white); min-height: 100vh; padding: clamp(1rem, 3vw, 4rem); }
        .display-screen h1 { font-size: clamp(2rem, 6vw, 6rem); margin-bottom: clamp(1rem, 3vw, 3rem); }
        .display-screen h2 { font-size: clamp(1.5rem, 4vw, 4rem); }
        .display-screen .queue-number { font-size: clamp(3rem, 10vw, 12rem); font-weight: 900; }
        
        /* Alerts & FAQ */
        .alert { padding: clamp(1rem, 2vw, 1.5rem); border-radius: clamp(0.5rem, 1vw, 1rem); margin-bottom: clamp(1rem, 2vw, 1.5rem); border: 2px solid; }
        .alert-warning { background: #fef9c3; border-color: var(--warning); color: #854d0e; }
        details summary { transition: all 0.3s ease; list-style: none; cursor: pointer; }
        details[open] summary { color: var(--primary); }
        details[open] summary span { transform: rotate(90deg); display: inline-block; }
        details summary::-webkit-details-marker { display: none; }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .flex { display: flex; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: clamp(0.5rem, 1vw, 1rem); }
        .w-full { width: 100%; }
        .hidden { display: none; }
        .space-y > * + * { margin-top: clamp(0.75rem, 1.5vw, 1.5rem); }
        .mb { margin-bottom: clamp(1rem, 2vw, 2rem); }
        .mt { margin-top: clamp(1rem, 2vw, 2rem); }
        
        /* Loading Animation */
        .loading-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; background: linear-gradient(135deg, #fff7ed 0%, #fce7f3 100%); }
        .loading-icon { font-size: clamp(3rem, 8vw, 6rem); margin-bottom: clamp(1rem, 2vw, 2rem); animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Responsive Breakpoints */
        @media (max-width: 640px) { nav .nav-buttons { width: 100%; justify-content: center; } .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; } }
        @media (min-width: 1920px) { body { font-size: 20px; } .display-screen .queue-number { font-size: 15rem; } }
        @media (min-width: 2560px) { body { font-size: 24px; } .container { max-width: 2000px; } .display-screen .queue-number { font-size: 20rem; } }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading-screen">
            <div class="loading-icon">‚è≥</div>
            <h1>Loading QueueApp...</h1>
        </div>
    </div>
    
    <script>
        // ============================================
        // FIREBASE CONFIGURATION & INITIALIZATION
        // ============================================
        
        // Firebase Config for queueapp-97728
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", // Replace with your actual API key
            authDomain: "queueapp-97728.firebaseapp.com",
            projectId: "queueapp-97728",
            storageBucket: "queueapp-97728.firebasestorage.app",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        
        // Firebase Admin User Management
        const FirebaseAdmin = {
            // Sign in with email/password
            async signIn(email, password) {
                try {
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    console.log('‚úÖ Firebase Admin signed in:', userCredential.user.email);
                    return { success: true, user: userCredential.user };
                } catch (error) {
                    console.error('‚ùå Firebase sign in error:', error);
                    return { success: false, error: error.message };
                }
            },
            
            // Sign out
            async signOut() {
                try {
                    await auth.signOut();
                    console.log('‚úÖ Firebase Admin signed out');
                    return { success: true };
                } catch (error) {
                    console.error('‚ùå Firebase sign out error:', error);
                    return { success: false, error: error.message };
                }
            },
            
            // Check if user is currently signed in
            getCurrentUser() {
                return auth.currentUser;
            },
            
            // Listen to auth state changes
            onAuthStateChanged(callback) {
                return auth.onAuthStateChanged(callback);
            }
        };
        
        window.FirebaseAdmin = FirebaseAdmin;
        
        // ============================================
        // DATABASE LAYER - localStorage wrapper
        // ============================================
        
        const DB = {
            restaurants: JSON.parse(localStorage.getItem('restaurants') || '{}'),
            save() { localStorage.setItem('restaurants', JSON.stringify(this.restaurants)); },
            addRestaurant(id, data) { 
                this.restaurants[id] = { ...data, queue: [], tables: [], createdAt: Date.now(), plan: 'free', planStatus: 'active', paymentProof: null, planExpiryDate: null }; 
                this.save(); return id; 
            },
            addToQueue(restaurantId, customer) { 
                const restaurant = this.restaurants[restaurantId]; 
                if (!restaurant) return null;
                const queueNumber = `A-${Math.floor(Math.random() * 900) + 100}`; 
                restaurant.queue.push({ ...customer, queueNumber, status: 'waiting', joinedAt: Date.now() }); 
                this.save(); return queueNumber; 
            },
            allocateTable(restaurantId, queueNumber, tableNo) { 
                const restaurant = this.restaurants[restaurantId]; 
                if (!restaurant) return false;
                const queueItem = restaurant.queue.find(q => q.queueNumber === queueNumber); 
                if (queueItem) { queueItem.status = 'allocated'; queueItem.tableNo = tableNo; queueItem.allocatedAt = Date.now(); this.save(); return true; } 
                return false; 
            },
            login(restaurantId, phone) { 
                const restaurant = this.restaurants[restaurantId]; 
                return restaurant && restaurant.phone === phone; 
            },
            savePaymentProof(restaurantId, paymentData) {
                const restaurant = this.restaurants[restaurantId];
                if (restaurant) { restaurant.paymentProof = { ...paymentData, uploadedAt: Date.now() }; restaurant.planStatus = 'pending'; this.save(); return true; }
                return false;
            },
            approvePremium(restaurantId) {
                const restaurant = this.restaurants[restaurantId];
                if (restaurant) { 
                    restaurant.plan = 'premium'; restaurant.planStatus = 'active'; 
                    const expiryDate = new Date(); expiryDate.setDate(expiryDate.getDate() + 30); 
                    restaurant.planExpiryDate = expiryDate.getTime(); this.save(); return true; 
                }
                return false;
            },
            rejectPremium(restaurantId) {
                const restaurant = this.restaurants[restaurantId];
                if (restaurant) { restaurant.planStatus = 'rejected'; if (restaurant.paymentProof) restaurant.paymentProof.rejectedAt = Date.now(); this.save(); return true; }
                return false;
            }
        };
        
        window.DB = DB;
        
        // Helper Functions
        function getLoggedInRestaurant() {
            const allRestaurants = Object.keys(DB.restaurants);
            for (let id of allRestaurants) { if (sessionStorage.getItem(`loggedIn_${id}`)) return { id, data: DB.restaurants[id] }; }
            return null;
        }
        function navigateHome() { const loggedIn = getLoggedInRestaurant(); loggedIn ? navigate(`/r/${loggedIn.id}/admin`) : navigate('/'); }
        function render(html) { document.getElementById('app').innerHTML = html; }
        function navigate(path) { window.location.hash = path; }
        
        // Router
        function handleRoute() {
            const hash = window.location.hash.slice(1) || '/';
            const parts = hash.split('/').filter(Boolean);
            
            if (hash === '/' || hash === '') showHome();
            else if (hash === '/pricing') showPricing();
            else if (hash === '/terms') showLegal('Terms of Service', getTermsContent());
            else if (hash === '/privacy') showLegal('Privacy Policy', getPrivacyContent());
            else if (hash === '/signup') showSignup();
            else if (hash === '/login') showLogin();
            else if (hash === '/admin') checkFirebaseAdminAuth() ? showPlatformAdmin() : showAdminPasswordPrompt();
            else if (parts[0] === 'payment' && parts[1] && parts[2] === 'upload') showUploadScreenshot(parts[1]);
            else if (parts[0] === 'payment' && parts[1]) showPaymentPage(parts[1]);
            else if (parts[0] === 'r' && parts[2] === 'join') showJoinQueue(parts[1]);
            else if (parts[0] === 'r' && parts[2] === 'display') showDisplay(parts[1]);
            else if (parts[0] === 'r' && parts[2] === 'status' && parts[3]) showQueueStatus(parts[1], parts[3]);
            else if (parts[0] === 'r' && parts[2] === 'admin') sessionStorage.getItem(`loggedIn_${parts[1]}`) ? showRestaurantAdmin(parts[1]) : showRestaurantLogin(parts[1]);
            else render(`<div class="container text-center" style="padding-top: 4rem;"><h1>404 - Page Not Found</h1><button onclick="navigate('/')" class="btn btn-primary mt">Go Home</button></div>`);
        }
        
        window.onhashchange = handleRoute;
        
        // Legal Pages Content
        function getTermsContent() {
            return `
                <h3>1. Acceptance of Terms</h3>
                <p>By using QueueApp, you agree to these Terms of Service.</p>
                
                <h3>2. Service Description</h3>
                <p>QueueApp provides digital queue management including: queue management, QR code entry, live displays, table allocation, and analytics.</p>
                
                <h3>3. Subscription Plans</h3>
                <p><strong>Free:</strong> 500 customers/month, 1 location, basic features - free forever.<br>
                <strong>Premium (‚Çπ2,999/month):</strong> Unlimited customers, advanced analytics, custom branding, priority support.</p>
                
                <h3>4. Payment Terms</h3>
                <p>Premium billed monthly in advance. All fees in INR, non-refundable. Cancel anytime to downgrade to Free.</p>
                
                <h3>5. User Responsibilities</h3>
                <p>You're responsible for all account activity. No illegal use. Comply with all laws. Maintain account security.</p>
                
                <h3>6. Contact</h3>
                <p>Email: support@queueapp.com</p>
            `;
        }
        
        function getPrivacyContent() {
            return `
                <h3>1. Information Collection</h3>
                <p><strong>Restaurant:</strong> Name, owner, email, phone, location, credentials.<br>
                <strong>Customer:</strong> Name, phone, queue status, guest count.</p>
                
                <h3>2. Data Use</h3>
                <p>Provide service, generate analytics, process payments, improve UX, comply with law.</p>
                
                <h3>3. Data Storage</h3>
                <p><strong>Free:</strong> Browser localStorage only.<br><strong>Premium:</strong> Secure server-side (when available).</p>
                
                <h3>4. Your Rights</h3>
                <p>Access, correct, delete, or export your data anytime.</p>
                
                <h3>5. Security</h3>
                <p>Secure storage, access controls, regular updates.</p>
                
                <h3>6. Contact</h3>
                <p>privacy@queueapp.com | support@queueapp.com</p>
            `;
        }
        
        function showLegal(title, content) {
            render(`
                <div style="min-height: 100vh; background: var(--gray-50);">
                    <nav><div class="container nav-content"><h1 onclick="navigateHome()">QueueApp</h1><button onclick="navigateHome()" class="btn btn-secondary">‚Üê Back</button></div></nav>
                    <div class="container" style="padding: 3rem 0; max-width: 900px;">
                        <h1 class="mb">${title}</h1>
                        <p style="color: var(--gray-600); margin-bottom: 2rem;">Last Updated: December 2024</p>
                        <div class="card" style="max-height: 600px; overflow-y: auto;"><div class="space-y" style="color: var(--gray-700);">${content}</div></div>
                        <div class="text-center mt"><button onclick="navigateHome()" class="btn btn-primary">Back to Home</button></div>
                    </div>
                </div>
            `);
        }
        
        // Home Page
        function showHome() {
            render(`
                <div class="bg-gradient" style="min-height: 100vh;">
                    <nav><div class="container nav-content"><h1 onclick="navigateHome()">QueueApp</h1>
                    <div class="nav-buttons">
                        <button onclick="navigate('/pricing')" class="btn btn-secondary">Pricing</button>
                        <button onclick="navigate('/login')" class="btn btn-secondary">Login</button>
                        <button onclick="navigate('/signup')" class="btn btn-primary">Sign Up</button>
                    </div></div></nav>
                    <main class="container text-center" style="padding: clamp(2rem, 5vw, 8rem) 0;">
                        <h1 style="margin-bottom: clamp(1rem, 2vw, 2rem);">Smart Queue Management</h1>
                        <p style="font-size: clamp(1.125rem, 2vw, 1.5rem); color: var(--gray-600); margin-bottom: clamp(2rem, 4vw, 4rem);">No more crowded entrances. Happy customers.</p>
                        <div class="grid grid-3 mb">
                            <div class="card text-center"><div style="font-size: clamp(2rem, 4vw, 4rem); margin-bottom: 1rem;">üì±</div><h3>Digital Queue</h3><p style="color: var(--gray-600);">Customers join via QR code</p></div>
                            <div class="card text-center"><div style="font-size: clamp(2rem, 4vw, 4rem); margin-bottom: 1rem;">üì∫</div><h3>Live Display</h3><p style="color: var(--gray-600);">Real-time queue on TV</p></div>
                            <div class="card text-center"><div style="font-size: clamp(2rem, 4vw, 4rem); margin-bottom: 1rem;">üìä</div><h3>Smart Analytics</h3><p style="color: var(--gray-600);">Track customer flow</p></div>
                        </div>
                        <button onclick="navigate('/signup')" class="btn btn-primary" style="font-size: clamp(1rem, 2vw, 1.5rem); padding: clamp(1rem, 2vw, 1.5rem) clamp(2rem, 4vw, 3rem);">Start Free Forever</button>
                        <p style="margin-top: 1rem; color: var(--gray-600);">No credit card required ‚Ä¢ 500 customers/month free</p>
                    </main>
                    <footer style="background: white; border-top: 2px solid var(--gray-200); padding: 2rem 0; margin-top: 4rem;">
                        <div class="container text-center">
                            <div style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; margin-bottom: 1rem;">
                                <button onclick="navigate('/terms')" style="background: none; border: none; color: var(--gray-600); cursor: pointer; text-decoration: underline;">Terms of Service</button>
                                <button onclick="navigate('/privacy')" style="background: none; border: none; color: var(--gray-600); cursor: pointer; text-decoration: underline;">Privacy Policy</button>
                                <a href="mailto:support@queueapp.com" style="color: var(--gray-600); text-decoration: underline;">Contact Support</a>
                            </div>
                            <p style="color: var(--gray-500); font-size: 0.875rem;">¬© 2024 QueueApp. All rights reserved.</p>
                        </div>
                    </footer>
                </div>
            `);
        }

        // Pricing Page with FAQ
        function showPricing() {
            const loggedIn = getLoggedInRestaurant();
            const restaurant = loggedIn?.data;
            const restaurantId = loggedIn?.id;
            const currentPlan = restaurant?.plan || 'free';
            const planStatus = restaurant?.planStatus || 'active';
            
            const navButtons = loggedIn 
                ? `<div class="flex gap-1 flex-wrap items-center">
                     <span style="font-weight: 600; color: var(--gray-700);">${restaurant.name}</span>
                     <span class="badge ${currentPlan === 'premium' ? 'badge-primary' : planStatus === 'pending' ? 'badge-warning' : 'badge-secondary'}">${planStatus === 'pending' ? 'PENDING' : currentPlan.toUpperCase()}</span>
                     <button onclick="navigate('/r/${restaurantId}/admin')" class="btn btn-secondary">Dashboard</button>
                     <button onclick="logout('${restaurantId}')" class="btn btn-danger">Logout</button>
                   </div>`
                : `<div class="nav-buttons"><button onclick="navigate('/login')" class="btn btn-secondary">Login</button><button onclick="navigate('/signup')" class="btn btn-primary">Sign Up</button></div>`;
            
            let premiumCTA;
            if (loggedIn && currentPlan === 'premium' && planStatus === 'active') {
                premiumCTA = `<button class="btn btn-success w-full" disabled style="opacity: 0.7; cursor: not-allowed;">‚úì Current Plan</button>`;
            } else if (loggedIn && planStatus === 'pending') {
                premiumCTA = `<button class="btn btn-warning w-full" disabled style="opacity: 0.7; cursor: not-allowed;">‚è≥ Verification Pending</button>`;
            } else if (loggedIn && currentPlan === 'free') {
                premiumCTA = `<button onclick="handleUpgrade('${restaurantId}')" class="btn w-full" style="background: white; color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">Upgrade Now</button>`;
            } else {
                premiumCTA = `<button onclick="navigate('/signup')" class="btn w-full" style="background: white; color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">Get Started</button>`;
            }

            render(`
                <div class="bg-gradient" style="min-height: 100vh;">
                    <nav><div class="container nav-content"><h1 onclick="navigateHome()">QueueApp</h1>${navButtons}</div></nav>
                    <div class="container" style="padding: clamp(2rem, 4vw, 4rem) 0;">
                        <div class="text-center mb">
                            <h1 style="margin-bottom: 1rem;">Simple, Honest Pricing</h1>
                            <p style="font-size: clamp(1rem, 2vw, 1.25rem); color: var(--gray-600); margin-bottom: 1rem;">Start free forever. Upgrade when you need more.</p>
                            ${loggedIn && planStatus === 'pending' ? '<div class="alert alert-warning" style="display: inline-block;">‚è≥ Payment verification in progress</div>' : ''}
                        </div>
                        
                        <div class="text-center" style="margin: 2rem 0;">
                            <p style="color: var(--success); font-weight: 600; font-size: clamp(1rem, 2vw, 1.25rem);">‚úÖ No Credit Card ‚Ä¢ No Setup Fees ‚Ä¢ Cancel Anytime</p>
                        </div>
                        
                        <div class="grid grid-2" style="max-width: 1200px; margin: 0 auto;">
                            <div class="card">
                                <div class="text-center">
                                    <p style="color: var(--success); font-weight: 700; font-size: 0.875rem; margin-bottom: 1rem;">FREE FOREVER</p>
                                    <h3 style="margin-bottom: 1rem;">Free</h3>
                                    <p style="color: var(--gray-600); margin-bottom: 1rem;">Perfect for getting started</p>
                                    <div style="font-size: clamp(2.5rem, 6vw, 4rem); font-weight: 900; margin-bottom: 1rem;">‚Çπ0<span style="font-size: clamp(1rem, 2vw, 1.5rem); color: var(--gray-600);">/month</span></div>
                                    <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 2rem;">Up to 500 customers/month</p>
                                </div>
                                <div class="space-y">
                                    <p>‚úì 1 location</p>
                                    <p>‚úì Digital queue management</p>
                                    <p>‚úì QR code entry</p>
                                    <p>‚úì Live display screen</p>
                                    <p>‚úì Basic analytics</p>
                                </div>
                                <div class="mt">
                                    <p class="text-center" style="color: var(--gray-600); font-size: 0.875rem; padding: 1rem; background: var(--gray-50); border-radius: 0.5rem;">Perfect for small cafes ‚Ä¢ ~17 customers/day</p>
                                </div>
                            </div>
                            
                            <div class="card bg-gradient-primary" style="transform: scale(1.05); position: relative;">
                                <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: var(--warning); color: white; padding: 0.5rem 1.5rem; border-radius: 999px; font-weight: 700; font-size: 0.875rem;">MOST POPULAR</div>
                                <div class="text-center">
                                    <p style="font-size: 0.875rem; margin-bottom: 0.5rem; opacity: 0.9;">ALL FEATURES</p>
                                    <h3 style="margin-bottom: 0.5rem;">Premium</h3>
                                    <p style="opacity: 0.9; margin-bottom: 1rem;">For serious restaurants</p>
                                    <div style="font-size: clamp(2.5rem, 6vw, 4rem); font-weight: 900; margin-bottom: 0.5rem;">‚Çπ2,999<span style="font-size: clamp(1rem, 2vw, 1.5rem); opacity: 0.8;">/month</span></div>
                                    <p style="opacity: 0.9; margin-bottom: 2rem;">Unlimited customers ‚Ä¢ Per location</p>
                                </div>
                                <div class="space-y">
                                    <p>‚úì Everything in Free, PLUS:</p>
                                    <p>‚úì Unlimited customers</p>
                                    <p>‚úì Advanced analytics</p>
                                    <p>‚úì Custom branding</p>
                                    <p>‚úì Priority support</p>
                                    <p style="opacity: 0.7;">üì± WhatsApp notifications (Coming Soon)</p>
                                </div>
                                <div class="mt">
                                    ${premiumCTA}
                                    <p class="text-center" style="margin-top: 1rem; font-size: 0.875rem; opacity: 0.9;">Instant activation ‚Ä¢ Cancel anytime</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mb" style="max-width: 1200px; margin: 3rem auto;">
                            <h2 class="text-center" style="margin-bottom: 2rem;">Frequently Asked Questions</h2>
                            <div class="space-y">
                                <details class="card" style="cursor: pointer; background: var(--gray-50); border: 1px solid var(--gray-200);">
                                    <summary style="font-weight: 600; padding: 1rem;"><span style="margin-right: 0.5rem;">‚ñ∏</span>Is the free plan really free forever?</summary>
                                    <p style="margin-top: 1rem; color: var(--gray-600); padding: 0 1rem 1rem 1rem; border-top: 1px solid var(--gray-200);">Yes! The free plan is completely free forever. You get 500 customers per month, 1 location, and all basic features with no credit card required. No hidden fees, no trials - it's genuinely free.</p>
                                </details>
                                <details class="card" style="cursor: pointer; background: var(--gray-50); border: 1px solid var(--gray-200);">
                                    <summary style="font-weight: 600; padding: 1rem;"><span style="margin-right: 0.5rem;">‚ñ∏</span>What happens if I exceed 500 customers on free?</summary>
                                    <p style="margin-top: 1rem; color: var(--gray-600); padding: 0 1rem 1rem 1rem; border-top: 1px solid var(--gray-200);">If you exceed 500 customers in a month, you'll need to upgrade to Premium for unlimited customers. We'll notify you as you approach the limit so you can plan accordingly.</p>
                                </details>
                                <details class="card" style="cursor: pointer; background: var(--gray-50); border: 1px solid var(--gray-200);">
                                    <summary style="font-weight: 600; padding: 1rem;"><span style="margin-right: 0.5rem;">‚ñ∏</span>Can I upgrade or downgrade anytime?</summary>
                                    <p style="margin-top: 1rem; color: var(--gray-600); padding: 0 1rem 1rem 1rem; border-top: 1px solid var(--gray-200);">Absolutely! You can upgrade to Premium anytime with instant activation. You can also downgrade back to Free at any time - you'll keep Premium features until the end of your billing period.</p>
                                </details>
                                <details class="card" style="cursor: pointer; background: var(--gray-50); border: 1px solid var(--gray-200);">
                                    <summary style="font-weight: 600; padding: 1rem;"><span style="margin-right: 0.5rem;">‚ñ∏</span>How does billing work for multiple locations?</summary>
                                    <p style="margin-top: 1rem; color: var(--gray-600); padding: 0 1rem 1rem 1rem; border-top: 1px solid var(--gray-200);">Each location is billed separately at ‚Çπ2,999/month. If you have multiple locations, you can manage them all from one account and choose which locations to upgrade to Premium.</p>
                                </details>
                            </div>
                        </div>
                    </div>
                </div>
            `);
        }
        
        // Payment Flow
        function showPaymentPage(restaurantId) {
            const restaurant = DB.restaurants[restaurantId];
            if (!restaurant) { render(`<div class="container text-center" style="padding-top: 4rem;"><h1 style="color: var(--danger);">Restaurant not found</h1></div>`); return; }

            render(`
                <div style="min-height: 100vh; background: linear-gradient(135deg, #faf5ff 0%, #eff6ff 100%); padding: clamp(1rem, 3vw, 3rem);">
                    <div class="card" style="max-width: 800px; margin: 0 auto;">
                        <div class="flex justify-between items-center mb">
                            <div><h2>Upgrade to Premium</h2><p style="color: var(--gray-600);">${restaurant.name}</p></div>
                            <button onclick="navigate('/pricing')" class="btn btn-secondary">‚úï</button>
                        </div>
                        <div class="card bg-gradient-primary text-center mb">
                            <p style="font-size: clamp(1rem, 2vw, 1.25rem); margin-bottom: 0.5rem;">Total Amount</p>
                            <div style="font-size: clamp(3rem, 8vw, 5rem); font-weight: 900;">‚Çπ2,999</div>
                            <p style="opacity: 0.9;">per month ‚Ä¢ 30 days validity</p>
                        </div>
                        <div class="mb">
                            <h3 class="text-center mb">Pay via UPI</h3>
                            <div class="card text-center" style="background: var(--gray-50);">
                                <p style="font-size: clamp(0.875rem, 1.5vw, 1rem); color: var(--gray-600); margin-bottom: 0.5rem;">UPI ID</p>
                                <p style="font-size: clamp(1.125rem, 2vw, 1.5rem); font-weight: 700; color: var(--primary); font-family: monospace;">sriramvasudev@okhdfcbank</p>
                            </div>
                            <div class="card text-center" style="background: var(--gray-50);">
                                <p style="font-weight: 600; margin-bottom: 1rem;">Scan QR Code</p>
                                <div id="payment-qr" style="display: inline-block; padding: 1rem; background: white; border-radius: 1rem;"></div>
                            </div>
                            <div class="space-y">
                                <button onclick="payWithUPIApp('phonepe', '${restaurantId}')" class="btn w-full" style="background: #5f259f;">üì± Pay with PhonePe</button>
                                <button onclick="payWithUPIApp('gpay', '${restaurantId}')" class="btn w-full" style="background: #2563eb;">üîµ Pay with Google Pay</button>
                                <button onclick="payWithUPIApp('paytm', '${restaurantId}')" class="btn w-full" style="background: #0891b2;">üíô Pay with Paytm</button>
                                <button onclick="payWithUPIApp('generic', '${restaurantId}')" class="btn btn-secondary w-full">üí∞ Pay with Any UPI App</button>
                            </div>
                            <div class="alert alert-warning mt"><strong>‚ö†Ô∏è Important:</strong> After payment, upload screenshot on next page for verification</div>
                        </div>
                        <button onclick="navigate('/payment/${restaurantId}/upload')" class="btn btn-success w-full">I've Completed Payment ‚Üí Upload Screenshot</button>
                    </div>
                </div>
            `);

            setTimeout(() => {
                const upiString = `upi://pay?pa=sriramvasudev@okhdfcbank&pn=QueueApp&am=2999&cu=INR&tn=QueueApp-${restaurantId}-Premium`;
                new QRCode(document.getElementById('payment-qr'), { text: upiString, width: 200, height: 200, colorDark: '#000000', colorLight: '#ffffff', correctLevel: QRCode.CorrectLevel.H });
            }, 100);
        }

        function showUploadScreenshot(restaurantId) {
            const restaurant = DB.restaurants[restaurantId];
            if (!restaurant) { render(`<div class="container text-center" style="padding-top: 4rem;"><h1 style="color: var(--danger);">Restaurant not found</h1></div>`); return; }

            render(`
                <div style="min-height: 100vh; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: clamp(1rem, 3vw, 3rem);">
                    <div class="card" style="max-width: 800px; margin: 0 auto;">
                        <h2 class="text-center">Upload Payment Proof</h2>
                        <p class="text-center" style="color: var(--gray-600); margin-bottom: 2rem;">${restaurant.name}</p>
                        <div class="space-y">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Transaction ID / UTR Number *</label>
                                <input type="text" id="transactionId" placeholder="e.g., 123456789012">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Upload Payment Screenshot *</label>
                                <div class="card text-center" style="border: 2px dashed var(--gray-200); cursor: pointer; background: var(--gray-50);" onclick="document.getElementById('screenshotFile').click()">
                                    <input type="file" id="screenshotFile" accept="image/*" onchange="previewScreenshot()" class="hidden">
                                    <button type="button" class="btn btn-primary" style="pointer-events: none;">üì∑ Choose Screenshot</button>
                                    <p style="margin-top: 1rem; font-size: 0.875rem; color: var(--gray-600);">PNG, JPG up to 5MB</p>
                                </div>
                                <div id="screenshotPreview" class="hidden mt">
                                    <p style="font-weight: 600; margin-bottom: 0.5rem;">Preview:</p>
                                    <img id="previewImage" class="w-full" style="border: 2px solid var(--gray-200); border-radius: 1rem;" />
                                </div>
                            </div>
                            <div class="card" style="background: #eff6ff; border: 2px solid #2563eb;">
                                <p style="font-weight: 600; color: #1e40af; margin-bottom: 0.5rem;">üìã What to include:</p>
                                <ul style="margin-left: 1.5rem; color: #1e40af;"><li>Transaction ID / UTR number</li><li>Amount paid (‚Çπ2,999)</li><li>Date and time</li><li>Transaction status (Success)</li></ul>
                            </div>
                            <button onclick="submitPaymentProof('${restaurantId}')" class="btn btn-success w-full">Submit for Verification</button>
                            <p class="text-center" style="font-size: 0.875rem; color: var(--gray-600);">Verification typically takes 2-24 hours</p>
                        </div>
                    </div>
                </div>
            `);
        }

        function previewScreenshot() {
            const file = document.getElementById('screenshotFile').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('screenshotPreview').classList.remove('hidden');
                    document.getElementById('previewImage').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function submitPaymentProof(restaurantId) {
            const transactionId = document.getElementById('transactionId').value.trim();
            const fileInput = document.getElementById('screenshotFile');
            if (!transactionId) { alert('‚ö†Ô∏è Please enter transaction ID'); return; }
            if (!fileInput.files[0]) { alert('‚ö†Ô∏è Please upload payment screenshot'); return; }

            const reader = new FileReader();
            reader.onload = function(e) {
                DB.savePaymentProof(restaurantId, { screenshot: e.target.result, transactionId: transactionId, amount: 2999 });
                alert('‚úÖ Payment proof submitted!\n\nVerification takes 2-24 hours.\nTrack status in your dashboard.');
                navigate(`/r/${restaurantId}/admin`);
            };
            reader.readAsDataURL(fileInput.files[0]);
        }

        function payWithUPIApp(app, restaurantId) {
            const upiId = 'sriramvasudev@okhdfcbank';
            const amount = '2999';
            const note = `QueueApp-${restaurantId}-Premium`;
            let url;
            switch(app) {
                case 'phonepe': url = `phonepe://pay?pa=${upiId}&pn=QueueApp&am=${amount}&cu=INR&tn=${encodeURIComponent(note)}`; break;
                case 'gpay': url = `tez://upi/pay?pa=${upiId}&pn=QueueApp&am=${amount}&cu=INR&tn=${encodeURIComponent(note)}`; break;
                case 'paytm': url = `paytmmp://pay?pa=${upiId}&pn=QueueApp&am=${amount}&cu=INR&tn=${encodeURIComponent(note)}`; break;
                default: url = `upi://pay?pa=${upiId}&pn=QueueApp&am=${amount}&cu=INR&tn=${encodeURIComponent(note)}`;
            }
            window.location.href = url;
            setTimeout(() => { window.location.href = `upi://pay?pa=${upiId}&pn=QueueApp&am=${amount}&cu=INR&tn=${encodeURIComponent(note)}`; }, 2000);
        }
        
        function handleUpgrade(restaurantId) { navigate(`/payment/${restaurantId}`); }
        
        // Auth Pages
        function showLogin() {
            render(`
                <div style="min-height: 100vh; background: linear-gradient(135deg, #3b82f6 0%, #9333ea 100%); display: flex; align-items: center; justify-content: center; padding: clamp(1rem, 3vw, 3rem);">
                    <div class="card" style="max-width: 500px; width: 100%;">
                        <h2 class="text-center mb">Restaurant Login</h2>
                        <div class="space-y">
                            <input type="text" id="loginRestaurantId" placeholder="Restaurant ID">
                            <input type="tel" id="loginPhone" placeholder="Phone Number" maxlength="10">
                            <button onclick="handleLogin()" class="btn btn-primary w-full">Login</button>
                            <p class="text-center" style="font-size: 0.875rem; color: var(--gray-600);">Don't have an account? <button onclick="navigate('/signup')" style="background: none; border: none; color: var(--primary); font-weight: 600; text-decoration: underline; cursor: pointer;">Sign Up</button></p>
                        </div>
                    </div>
                </div>
            `);
        }
        
        function handleLogin() {
            const restaurantId = document.getElementById('loginRestaurantId').value.trim();
            const phone = document.getElementById('loginPhone').value.trim();
            if (!restaurantId || !phone) { alert('Please enter Restaurant ID and Phone'); return; }
            if (DB.login(restaurantId, phone)) { 
                sessionStorage.setItem(`loggedIn_${restaurantId}`, 'true'); 
                alert('‚úÖ Login successful!'); 
                navigate(`/r/${restaurantId}/admin`); 
            } else { alert('‚ùå Invalid Restaurant ID or Phone Number'); }
        }
        
        function showRestaurantLogin(restaurantId) {
            render(`
                <div style="min-height: 100vh; background: linear-gradient(135deg, #3b82f6 0%, #9333ea 100%); display: flex; align-items: center; justify-content: center; padding: clamp(1rem, 3vw, 3rem);">
                    <div class="card" style="max-width: 500px; width: 100%;">
                        <h2 class="text-center mb">Login Required</h2>
                        <p class="text-center mb" style="color: var(--gray-600);">Please login to access admin panel</p>
                        <input type="tel" id="restaurantLoginPhone" placeholder="Phone Number" maxlength="10">
                        <button onclick="handleRestaurantLogin('${restaurantId}')" class="btn btn-primary w-full mt">Login</button>
                    </div>
                </div>
            `);
        }
        
        function handleRestaurantLogin(restaurantId) {
            const phone = document.getElementById('restaurantLoginPhone').value.trim();
            if (!phone) { alert('Please enter phone number'); return; }
            if (DB.login(restaurantId, phone)) { sessionStorage.setItem(`loggedIn_${restaurantId}`, 'true'); handleRoute(); } 
            else { alert('‚ùå Invalid phone number'); }
        }
        
        function showSignup() {
            render(`
                <div style="min-height: 100vh; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); display: flex; align-items: center; justify-content: center; padding: clamp(1rem, 3vw, 3rem);">
                    <div class="card" style="max-width: 700px; width: 100%;">
                        <h2 class="text-center mb">Register Your Restaurant</h2>
                        <div class="space-y">
                            <input type="text" id="restaurantName" placeholder="Restaurant Name">
                            <input type="text" id="ownerName" placeholder="Owner Name">
                            <input type="email" id="email" placeholder="Email">
                            <input type="tel" id="phone" placeholder="Phone (10 digits)" maxlength="10">
                            <input type="text" id="city" placeholder="Branch Location (e.g., Mumbai - Andheri West)">
                            <div class="flex gap-1" style="align-items: flex-start;">
                                <input type="checkbox" id="agreeTerms" class="mt-1">
                                <label for="agreeTerms" style="font-size: 0.875rem; color: var(--gray-700);">I agree to the Terms of Service and Privacy Policy</label>
                            </div>
                            <button onclick="handleSignup()" class="btn btn-primary w-full">Register</button>
                            <p class="text-center" style="font-size: 0.875rem; color: var(--gray-600);">Already registered? <button onclick="navigate('/login')" style="background: none; border: none; color: var(--primary); font-weight: 600; text-decoration: underline; cursor: pointer;">Login</button></p>
                        </div>
                    </div>
                </div>
            `);
        }
        
        function handleSignup() {
            const name = document.getElementById('restaurantName').value;
            const owner = document.getElementById('ownerName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const city = document.getElementById('city').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;
            
            if (!name || !owner || !email || !phone || !city) { alert('Please fill all fields including branch location'); return; }
            if (!agreeTerms) { alert('‚ö†Ô∏è Please agree to Terms of Service and Privacy Policy'); return; }
            
            const restaurantId = name.substring(0, 3).toUpperCase().replace(/[^A-Z]/g, 'X') + Math.floor(Math.random() * 1000);
            DB.addRestaurant(restaurantId, { name, owner, email, phone, city });
            sessionStorage.setItem(`loggedIn_${restaurantId}`, 'true');
            alert(`‚úÖ Success! Your Restaurant ID: ${restaurantId}\n\nüéâ You're on the FREE plan (500 customers/month)`);
            navigate(`/r/${restaurantId}/admin`);
        }
        
        // Customer Queue Functions
        function showJoinQueue(restaurantId) {
            const restaurant = DB.restaurants[restaurantId];
            if (!restaurant) { render(`<div class="container text-center" style="padding-top: 4rem;"><h1 style="color: var(--danger);">Restaurant not found</h1></div>`); return; }
            render(`
                <div style="min-height: 100vh; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); display: flex; align-items: center; justify-content: center; padding: clamp(1rem, 3vw, 3rem);">
                    <div class="card" style="max-width: 500px; width: 100%;">
                        <h2 class="text-center mb">Join Queue</h2>
                        <p class="text-center mb" style="color: var(--gray-600);">${restaurant.name}</p>
                        <div class="space-y">
                            <input type="text" id="customerName" placeholder="Your Name">
                            <input type="tel" id="customerPhone" placeholder="Mobile (10 digits)" maxlength="10">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Number of Guests</label>
                                <div class="grid grid-4">${[1,2,3,4,5,6,7,8].map(n => `<button onclick="selectGuests(${n})" id="guest-${n}" class="btn ${n === 2 ? 'btn-primary' : 'btn-secondary'}">${n}</button>`).join('')}</div>
                            </div>
                            <button onclick="handleJoinQueue('${restaurantId}')" class="btn btn-primary w-full">Join Queue</button>
                        </div>
                    </div>
                </div>
            `);
            window.selectedGuests = 2;
        }
        
        function selectGuests(n) {
            window.selectedGuests = n;
            document.querySelectorAll('[id^="guest-"]').forEach(btn => btn.className = 'btn btn-secondary');
            document.getElementById(`guest-${n}`).className = 'btn btn-primary';
        }
        
        function handleJoinQueue(restaurantId) {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const guests = window.selectedGuests || 2;
            if (!name || !phone) { alert('Please fill all fields'); return; }
            const queueNumber = DB.addToQueue(restaurantId, { name, phone, guests });
            alert(`‚úÖ You're in queue!\n\nYour number: ${queueNumber}\n\nWatch the display screen!`);
            navigate(`/r/${restaurantId}/status/${queueNumber}`);
        }
        
        function showQueueStatus(restaurantId, queueNumber) {
            const restaurant = DB.restaurants[restaurantId];
            if (!restaurant) return;
            const myQueue = restaurant.queue.find(q => q.queueNumber === queueNumber);
            if (!myQueue) { render(`<div class="container text-center" style="padding-top: 4rem;"><h1>Queue Number Not Found</h1><button onclick="navigate('/r/${restaurantId}/join')" class="btn btn-primary mt">Join Queue</button></div>`); return; }
            
            if (myQueue.status === 'allocated') {
                render(`
                    <div style="min-height: 100vh; background: var(--success); display: flex; align-items: center; justify-content: center; color: white; padding: clamp(1rem, 3vw, 3rem);">
                        <div class="text-center">
                            <h1 style="margin-bottom: 2rem;">üéâ Table Ready!</h1>
                            <div class="card" style="background: white; color: var(--gray-900);">
                                <div style="font-size: clamp(5rem, 15vw, 12rem); font-weight: 900; color: var(--success);">${myQueue.tableNo}</div>
                                <p style="font-size: clamp(1.5rem, 3vw, 2rem);">Queue: ${queueNumber}</p>
                            </div>
                        </div>
                    </div>
                `);
            } else {
                const waiting = restaurant.queue.filter(q => q.status === 'waiting');
                const position = waiting.findIndex(q => q.queueNumber === queueNumber) + 1;
                render(`
                    <div style="min-height: 100vh; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; padding: clamp(1rem, 3vw, 3rem);">
                        <div class="text-center">
                            <h1 style="margin-bottom: 2rem;">Still in Queue</h1>
                            <div class="card" style="background: white; color: var(--gray-900);">
                                <div style="font-size: clamp(5rem, 15vw, 12rem); font-weight: 900; color: var(--primary);">${queueNumber}</div>
                                <p style="font-size: clamp(1.5rem, 3vw, 2rem);">Position: #${position}</p>
                            </div>
                            <button onclick="navigate('/r/${restaurantId}/display')" class="btn btn-primary mt" style="background: white; color: var(--primary);">View Display</button>
                        </div>
                    </div>
                `);
            }
        }
        
        // TV Display Screen - Compressed but complete
        function showDisplay(restaurantId) {
            const restaurant = DB.restaurants[restaurantId];
            if (!restaurant) return;
            const waiting = restaurant.queue.filter(q => q.status === 'waiting');
            const allocated = restaurant.queue.filter(q => q.status === 'allocated');
            const justCalled = allocated.slice(-3);
            
            render(`
                <div class="display-screen">
                    <div class="container">
                        <div class="text-center mb" style="padding-bottom: clamp(1rem, 3vw, 3rem); border-bottom: 4px solid var(--primary);">
                            <h1 style="color: var(--primary); margin-bottom: 0.5rem;">${restaurant.name}</h1>
                            <p style="font-size: clamp(1rem, 2vw, 2rem); color: rgba(255,255,255,0.7);">Queue Management System</p>
                            <div style="font-size: clamp(1.5rem, 3vw, 3rem); color: var(--primary); font-weight: 700; margin-top: 0.5rem;">${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</div>
                        </div>
                        
                        ${justCalled.length > 0 ? `
                        <div class="card mb" style="background: linear-gradient(135deg, rgba(22, 163, 74, 0.9) 0%, rgba(21, 128, 61, 0.9) 100%); border: 4px solid var(--success); padding: clamp(2rem, 4vw, 4rem);">
                            <div class="text-center mb"><h2 style="font-size: clamp(2rem, 4vw, 5rem); margin-bottom: clamp(1rem, 2vw, 2rem); display: flex; align-items: center; justify-content: center; gap: 1rem;"><span style="font-size: clamp(3rem, 6vw, 8rem); animation: pulse 2s ease-in-out infinite;">üîî</span>NOW SERVING</h2></div>
                            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr)); gap: clamp(1.5rem, 3vw, 3rem);">
                                ${justCalled.map(a => `<div class="card text-center" style="background: rgba(255, 255, 255, 0.95); padding: clamp(2rem, 4vw, 4rem); border: 4px solid #ffffff;"><div style="font-size: clamp(4rem, 10vw, 12rem); font-weight: 900; color: var(--success); line-height: 1;">${a.queueNumber}</div><div style="font-size: clamp(2rem, 5vw, 6rem); font-weight: 800; color: var(--gray-900);">Table ${a.tableNo}</div><div style="font-size: clamp(1.25rem, 3vw, 3rem); color: var(--gray-600);">${a.guests} ${a.guests === 1 ? 'guest' : 'guests'}</div></div>`).join('')}
                            </div>
                        </div>
                        ` : `<div class="card text-center mb" style="background: rgba(55, 65, 81, 0.5); padding: clamp(2rem, 4vw, 4rem);"><p style="font-size: clamp(1.5rem, 3vw, 4rem); color: rgba(255,255,255,0.6);">‚è≥ Waiting for first customer...</p></div>`}
                        
                        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(min(400px, 100%), 1fr)); gap: clamp(1.5rem, 3vw, 3rem);">
                            <div class="card" style="background: rgba(249, 115, 22, 0.2); border: 3px solid var(--primary); padding: clamp(1.5rem, 3vw, 3rem);">
                                <h2 class="text-center" style="color: var(--primary); margin-bottom: clamp(1rem, 2vw, 2rem); font-size: clamp(1.5rem, 3vw, 4rem);"><span style="font-size: clamp(2rem, 4vw, 5rem);">‚è≥</span> Waiting Queue (${waiting.length})</h2>
                                <div style="max-height: 60vh; overflow-y: auto;"><div class="space-y">
                                    ${waiting.length > 0 ? waiting.slice(0, 15).map((w, i) => `
                                        <div class="card" style="background: ${i < 3 ? 'rgba(249, 115, 22, 0.9)' : 'rgba(55, 65, 81, 0.8)'}; padding: clamp(1rem, 2vw, 2rem); border: ${i < 3 ? '3px solid var(--primary)' : '2px solid rgba(156, 163, 175, 0.3)'};">
                                            <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                                <div style="flex: 1; min-width: 200px;">
                                                    <div style="font-size: clamp(2rem, 5vw, 6rem); font-weight: 900; color: ${i < 3 ? '#ffffff' : 'var(--primary)'}; line-height: 1;">${w.queueNumber}</div>
                                                    ${i < 3 ? '<div style="font-size: clamp(1rem, 2vw, 1.5rem); color: #fef9c3; font-weight: 700; margin-top: 0.5rem;">üîú COMING UP NEXT</div>' : ''}
                                                    <div style="font-size: clamp(1rem, 2vw, 1.5rem); color: ${i < 3 ? 'rgba(255,255,255,0.9)' : 'rgba(255,255,255,0.7)'}; margin-top: 0.5rem;">${w.guests} ${w.guests === 1 ? 'guest' : 'guests'}</div>
                                                </div>
                                                <div style="text-align: right;">
                                                    <div style="font-size: clamp(2.5rem, 5vw, 5rem); font-weight: 900; color: ${i < 3 ? '#ffffff' : 'rgba(255,255,255,0.7)'};">#${i + 1}</div>
                                                    <div style="font-size: clamp(0.875rem, 1.5vw, 1.25rem); color: rgba(255,255,255,0.6);">~${(i + 1) * 5} min</div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('') : '<p class="text-center" style="color: rgba(255,255,255,0.6); font-size: clamp(1.25rem, 2vw, 2rem); padding: 2rem;">No customers waiting</p>'}
                                </div></div>
                            </div>
                            
                            <div class="space-y" style="display: flex; flex-direction: column; gap: clamp(1.5rem, 3vw, 3rem);">
                                <div class="card" style="background: rgba(59, 130, 246, 0.2); border: 3px solid #2563eb; padding: clamp(1.5rem, 3vw, 3rem);">
                                    <h2 class="text-center" style="color: #60a5fa; margin-bottom: clamp(1rem, 2vw, 2rem); font-size: clamp(1.5rem, 3vw, 3rem);">üì± How to Join Queue</h2>
                                    <div class="space-y" style="font-size: clamp(1rem, 2vw, 2rem); color: white;">
                                        ${['1Ô∏è‚É£ Scan QR code at entrance', '2Ô∏è‚É£ Enter your details', '3Ô∏è‚É£ Get queue number', '4Ô∏è‚É£ Watch this screen!'].map(step => `<div style="display: flex; align-items: center; gap: clamp(0.75rem, 2vw, 1.5rem); padding: clamp(0.5rem, 1vw, 1rem); background: rgba(59, 130, 246, 0.2); border-radius: clamp(0.5rem, 1vw, 1rem);"><span>${step}</span></div>`).join('')}
                                    </div>
                                </div>
                                <div class="card" style="background: rgba(168, 85, 247, 0.2); border: 3px solid #9333ea; padding: clamp(1.5rem, 3vw, 3rem);">
                                    <h2 class="text-center" style="color: #c084fc; margin-bottom: clamp(1rem, 2vw, 2rem); font-size: clamp(1.5rem, 3vw, 3rem);">üìä Live Stats</h2>
                                    <div class="grid grid-2" style="gap: clamp(1rem, 2vw, 2rem);">
                                        <div class="card text-center" style="background: rgba(255, 255, 255, 0.1); padding: clamp(1rem, 2vw, 2rem);"><div style="font-size: clamp(3rem, 7vw, 7rem); font-weight: 900; color: var(--primary);">${waiting.length}</div><div style="font-size: clamp(1rem, 2vw, 1.5rem); color: white; margin-top: 0.5rem;">Waiting</div></div>
                                        <div class="card text-center" style="background: rgba(255, 255, 255, 0.1); padding: clamp(1rem, 2vw, 2rem);"><div style="font-size: clamp(3rem, 7vw, 7rem); font-weight: 900; color: var(--success);">${allocated.length}</div><div style="font-size: clamp(1rem, 2vw, 1.5rem); color: white; margin-top: 0.5rem;">Seated</div></div>
                                        <div class="card text-center" style="background: rgba(255, 255, 255, 0.1); padding: clamp(1rem, 2vw, 2rem); grid-column: 1 / -1;"><div style="font-size: clamp(3rem, 7vw, 7rem); font-weight: 900; color: #60a5fa;">~${waiting.length * 5} min</div><div style="font-size: clamp(1rem, 2vw, 1.5rem); color: white; margin-top: 0.5rem;">Estimated Wait</div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt" style="padding-top: clamp(2rem, 4vw, 4rem); border-top: 2px solid rgba(255,255,255,0.2);"><p style="font-size: clamp(1rem, 2vw, 2rem); color: rgba(255,255,255,0.5);">‚ö° Powered by QueueApp</p></div>
                    </div>
                </div>
            `);
            setTimeout(() => handleRoute(), 3000);
        }
        
        // Restaurant Admin Dashboard
        function showRestaurantAdmin(restaurantId) {
            const restaurant = DB.restaurants[restaurantId];
            if (!restaurant) return;
            const waiting = restaurant.queue.filter(q => q.status === 'waiting');
            const allocated = restaurant.queue.filter(q => q.status === 'allocated');
            const currentPlan = restaurant.plan || 'free';
            const planStatus = restaurant.planStatus || 'active';
            const planBadge = `<span class="badge ${currentPlan === 'premium' && planStatus === 'active' ? 'badge-primary' : planStatus === 'pending' ? 'badge-warning' : 'badge-secondary'}">${planStatus === 'pending' ? 'PENDING' : currentPlan.toUpperCase()}</span>`;
            
            render(`
                <div style="min-height: 100vh; background: var(--gray-100); padding: clamp(1rem, 3vw, 3rem);">
                    <div class="container">
                        <div class="card mb flex justify-between items-center flex-wrap gap-1">
                            <div><h1 onclick="navigateHome()" style="cursor: pointer;">QueueApp</h1><p style="color: var(--gray-600);">${restaurant.name} - Admin ${planBadge}</p></div>
                            <div class="flex gap-1">
                                <button onclick="navigate('/pricing')" class="btn" style="background: #2563eb; color: white;">${currentPlan === 'free' && planStatus !== 'pending' ? 'Upgrade' : 'Manage Plan'}</button>
                                <button onclick="logout('${restaurantId}')" class="btn btn-danger">Logout</button>
                            </div>
                        </div>
                        ${planStatus === 'pending' ? '<div class="alert alert-warning mb">‚è≥ Premium upgrade pending verification.</div>' : ''}
                        <div class="grid grid-2 mb">
                            <div class="card" style="background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);"><div style="font-size: clamp(2rem, 5vw, 3rem); font-weight: 900; color: var(--primary);">${waiting.length}</div><p style="color: var(--gray-600);">Customers Waiting</p></div>
                            <div class="card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);"><div style="font-size: clamp(2rem, 5vw, 3rem); font-weight: 900; color: var(--success);">${allocated.length}</div><p style="color: var(--gray-600);">Tables Occupied</p></div>
                        </div>
                        <div class="card mb">
                            <h2 style="margin-bottom: 1rem;">Waiting Queue</h2>
                            <div class="space-y">
                                ${waiting.length > 0 ? waiting.map(w => `
                                    <div class="card flex justify-between items-center flex-wrap gap-1" style="background: var(--gray-50);">
                                        <div><div style="font-size: clamp(1.25rem, 2vw, 1.5rem); font-weight: 700;">${w.queueNumber}</div><p style="color: var(--gray-600);">${w.name} ‚Ä¢ ${w.phone} ‚Ä¢ ${w.guests} guests</p></div>
                                        <div class="flex gap-1 items-center">
                                            <input type="number" id="table-${w.queueNumber}" placeholder="Table #" style="width: clamp(80px, 15vw, 100px);" min="1">
                                            <button onclick="allocateTable('${restaurantId}', '${w.queueNumber}')" class="btn btn-success">Seat</button>
                                        </div>
                                    </div>
                                `).join('') : '<p class="text-center" style="color: var(--gray-600); padding: 2rem;">No customers in queue</p>'}
                            </div>
                        </div>
                        <div class="flex gap-1 flex-wrap">
                            <button onclick="navigate('/r/${restaurantId}/display')" class="btn" style="background: #2563eb; color: white;">üì∫ Display Screen</button>
                            <button onclick="navigate('/r/${restaurantId}/join')" class="btn" style="background: #9333ea; color: white;">üì± Customer Entry</button>
                        </div>
                    </div>
                </div>
            `);
        }
        
        function allocateTable(restaurantId, queueNumber) {
            const tableNo = document.getElementById(`table-${queueNumber}`).value;
            if (!tableNo || tableNo < 1) { alert('‚ö†Ô∏è Please enter a valid table number'); return; }
            DB.allocateTable(restaurantId, queueNumber, tableNo);
            alert(`‚úÖ Table ${tableNo} allocated to ${queueNumber}!`);
            handleRoute();
        }
        
        function logout(restaurantId) {
            sessionStorage.removeItem(`loggedIn_${restaurantId}`);
            alert('‚úÖ Logged out successfully');
            navigate('/');
        }
        
        // Platform Admin
        // ============================================
        // PLATFORM ADMIN - FIREBASE AUTHENTICATION
        // ============================================
        
        function showAdminPasswordPrompt() {
            render(`
                <div style="min-height: 100vh; background: linear-gradient(135deg, #111827 0%, #1f2937 100%); display: flex; align-items: center; justify-content: center; padding: clamp(1rem, 3vw, 3rem);">
                    <div class="card" style="max-width: 500px; width: 100%;">
                        <h2 class="text-center mb">üîê Platform Admin Login</h2>
                        <p class="text-center" style="color: var(--gray-600); margin-bottom: 2rem; font-size: 0.875rem;">Sign in with Firebase credentials</p>
                        <div class="space-y">
                            <input type="email" id="adminEmail" placeholder="Admin Email" autocomplete="email">
                            <input type="password" id="adminPassword" placeholder="Password" autocomplete="current-password">
                            <button onclick="firebaseAdminLogin(event)" class="btn w-full" style="background: var(--gray-900); color: white;">Sign In</button>
                            <div id="adminLoginError" class="hidden alert alert-warning" style="margin-top: 1rem;"></div>
                        </div>
                    </div>
                </div>
            `);
        }
        
        async function firebaseAdminLogin(event) {
            const email = document.getElementById('adminEmail').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            const errorDiv = document.getElementById('adminLoginError');
            
            if (!email || !password) {
                errorDiv.textContent = '‚ö†Ô∏è Please enter both email and password';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Show loading state
            const btn = event ? event.target : document.querySelector('button[onclick*="firebaseAdminLogin"]');
            const originalText = btn.textContent;
            btn.textContent = 'Signing in...';
            btn.disabled = true;
            
            try {
                // Attempt Firebase sign in
                const result = await FirebaseAdmin.signIn(email, password);
                
                if (result.success) {
                    // Store auth state in sessionStorage
                    sessionStorage.setItem('adminAuth', 'yes');
                    sessionStorage.setItem('adminEmail', result.user.email);
                    sessionStorage.setItem('adminUid', result.user.uid);
                    
                    // Success - navigate to admin panel
                    console.log('‚úÖ Login successful, navigating to /admin');
                    
                    // Force immediate navigation
                    window.location.hash = '/admin';
                    
                    // Small delay to ensure hash change triggers, then force route
                    setTimeout(() => {
                        handleRoute();
                    }, 100);
                } else {
                    // Show error
                    errorDiv.textContent = `‚ùå ${result.error}`;
                    errorDiv.classList.remove('hidden');
                    
                    // Reset button
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            } catch (error) {
                console.error('Login error:', error);
                errorDiv.textContent = `‚ùå ${error.message}`;
                errorDiv.classList.remove('hidden');
                
                // Reset button
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }
        
        // Check Firebase auth state on admin route
        function checkFirebaseAdminAuth() {
            const currentUser = FirebaseAdmin.getCurrentUser();
            const sessionAuth = sessionStorage.getItem('adminAuth');
            
            // If Firebase user exists and session is valid, allow access
            if (currentUser && sessionAuth === 'yes') {
                return true;
            }
            
            // If session exists but no Firebase user, clear session
            if (sessionAuth === 'yes' && !currentUser) {
                sessionStorage.removeItem('adminAuth');
                sessionStorage.removeItem('adminEmail');
                sessionStorage.removeItem('adminUid');
            }
            
            return false;
        }
        
        
        function showPlatformAdmin() {
            const restaurants = Object.entries(DB.restaurants);
            const pendingPayments = restaurants.filter(([_, r]) => r.planStatus === 'pending');
            const totalCustomers = restaurants.reduce((sum, [_, r]) => sum + r.queue.length, 0);
            const totalRevenue = restaurants.filter(([_, r]) => r.plan === 'premium' && r.planStatus === 'active').length * 2999;
            
            render(`
                <div style="min-height: 100vh; background: var(--gray-100); padding: clamp(1rem, 3vw, 3rem);">
                    <div class="container">
                        <div class="card mb flex justify-between items-center flex-wrap"><div><h1>üè¢ Platform Admin</h1><p style="color: var(--gray-600);">Manage all restaurants</p></div><button onclick="adminLogout()" class="btn btn-danger">Logout</button></div>
                        <div class="grid grid-4 mb">
                            <div class="card" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);"><div style="font-size: clamp(2rem, 5vw, 3rem); font-weight: 900; color: #2563eb;">${restaurants.length}</div><p style="color: var(--gray-600);">Total Restaurants</p></div>
                            <div class="card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);"><div style="font-size: clamp(2rem, 5vw, 3rem); font-weight: 900; color: var(--success);">${totalCustomers}</div><p style="color: var(--gray-600);">Total Customers</p></div>
                            <div class="card" style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);"><div style="font-size: clamp(2rem, 5vw, 3rem); font-weight: 900; color: #9333ea;">‚Çπ${totalRevenue.toLocaleString()}</div><p style="color: var(--gray-600);">Monthly Revenue</p></div>
                            <div class="card" style="background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);"><div style="font-size: clamp(2rem, 5vw, 3rem); font-weight: 900; color: var(--warning);">${pendingPayments.length}</div><p style="color: var(--gray-600);">Pending Payments</p></div>
                        </div>
                        ${pendingPayments.length > 0 ? `
                            <div class="card mb" style="border: 2px solid var(--warning);">
                                <h2 style="color: var(--warning); margin-bottom: 1rem;">‚è≥ Pending Payment Verifications (${pendingPayments.length})</h2>
                                <div class="space-y">
                                    ${pendingPayments.map(([id, r]) => `
                                        <div class="card" style="background: #fef9c3;">
                                            <div class="flex justify-between items-start flex-wrap gap-1">
                                                <div style="flex: 1;">
                                                    <h3>${r.name}</h3>
                                                    <p style="color: var(--gray-600); font-size: 0.875rem;">ID: ${id} ‚Ä¢ Owner: ${r.owner}</p>
                                                    <p style="color: var(--gray-600); font-size: 0.875rem;">Transaction: ${r.paymentProof?.transactionId || 'N/A'}</p>
                                                    <p style="color: var(--gray-600); font-size: 0.875rem;">Uploaded: ${new Date(r.paymentProof?.uploadedAt || 0).toLocaleString()}</p>
                                                </div>
                                                <div class="flex gap-1 flex-wrap">
                                                    <button onclick="viewScreenshot('${id}')" class="btn" style="background: #2563eb; color: white;">View</button>
                                                    <button onclick="approvePayment('${id}')" class="btn btn-success">‚úì Approve</button>
                                                    <button onclick="rejectPayment('${id}')" class="btn btn-danger">‚úó Reject</button>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        <div class="card">
                            <h2 style="margin-bottom: 1rem;">All Restaurants</h2>
                            <div class="space-y">
                                ${restaurants.map(([id, r]) => `
                                    <div class="card" style="background: var(--gray-50);">
                                        <div class="flex justify-between items-center flex-wrap gap-1">
                                            <div>
                                                <h3>${r.name} ${r.plan === 'premium' && r.planStatus === 'active' ? '<span class="badge badge-primary">PREMIUM</span>' : r.planStatus === 'pending' ? '<span class="badge badge-warning">PENDING</span>' : '<span class="badge badge-secondary">FREE</span>'}</h3>
                                                <p style="color: var(--gray-600); font-size: 0.875rem;">ID: ${id} ‚Ä¢ ${r.city} ‚Ä¢ ${r.queue.length} customers</p>
                                            </div>
                                            <div class="flex gap-1">
                                                <button onclick="navigate('/r/${id}/admin')" class="btn btn-secondary">Admin</button>
                                                <button onclick="navigate('/r/${id}/display')" class="btn" style="background: #2563eb; color: white;">Display</button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `);
        }
        
        function viewScreenshot(restaurantId) {
            const restaurant = DB.restaurants[restaurantId];
            if (restaurant && restaurant.paymentProof && restaurant.paymentProof.screenshot) {
                window.open(restaurant.paymentProof.screenshot, '_blank');
            } else { alert('No screenshot available'); }
        }
        
        function approvePayment(restaurantId) {
            if (confirm('Approve this Premium payment?')) {
                DB.approvePremium(restaurantId);
                alert('‚úÖ Premium activated for 30 days!');
                handleRoute();
            }
        }
        
        function rejectPayment(restaurantId) {
            if (confirm('Reject this payment?')) {
                DB.rejectPayment(restaurantId);
                alert('‚ùå Payment rejected.');
                handleRoute();
            }
        }
        
        async function adminLogout() {
            // Sign out from Firebase
            const result = await FirebaseAdmin.signOut();
            
            // Clear session storage
            sessionStorage.removeItem('adminAuth');
            sessionStorage.removeItem('adminEmail');
            sessionStorage.removeItem('adminUid');
            
            if (result.success) {
                alert('‚úÖ Logged out successfully');
            } else {
                alert('‚úÖ Logged out (local session cleared)');
            }
            
            navigate('/');
        }
        
        // Export all functions
        window.navigate = navigate;
        window.navigateHome = navigateHome;
        window.selectGuests = selectGuests;
        window.handleSignup = handleSignup;
        window.handleLogin = handleLogin;
        window.handleRestaurantLogin = handleRestaurantLogin;
        window.handleJoinQueue = handleJoinQueue;
        window.allocateTable = allocateTable;
        window.logout = logout;
        window.firebaseAdminLogin = firebaseAdminLogin;
        window.adminLogout = adminLogout;
        window.handleUpgrade = handleUpgrade;
        window.payWithUPIApp = payWithUPIApp;
        window.previewScreenshot = previewScreenshot;
        window.submitPaymentProof = submitPaymentProof;
        window.viewScreenshot = viewScreenshot;
        window.approvePayment = approvePayment;
        window.rejectPayment = rejectPayment;
        
        // ============================================
        // FIREBASE AUTH STATE LISTENER
        // ============================================
        
        // Listen for Firebase auth state changes
        FirebaseAdmin.onAuthStateChanged((user) => {
            if (user) {
                console.log('üî• Firebase Admin User:', user.email);
                // User is signed in - ensure session is set
                if (sessionStorage.getItem('adminAuth') !== 'yes') {
                    sessionStorage.setItem('adminAuth', 'yes');
                    sessionStorage.setItem('adminEmail', user.email);
                    sessionStorage.setItem('adminUid', user.uid);
                }
            } else {
                console.log('üî• Firebase: No admin user signed in');
                // User is signed out - clear session
                if (sessionStorage.getItem('adminAuth') === 'yes') {
                    sessionStorage.removeItem('adminAuth');
                    sessionStorage.removeItem('adminEmail');
                    sessionStorage.removeItem('adminUid');
                }
            }
        });
        
        // Initialize app
        setTimeout(() => handleRoute(), 500);
    </script>
</body>
</html>
